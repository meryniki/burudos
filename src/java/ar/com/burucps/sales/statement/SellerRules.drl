package ar.com.burucps.sales.statement;

import ar.com.burudos.party.Employee;

import ar.com.burudos.sales.statement.Parameter;
import ar.com.burudos.sales.statement.EmployeeStatement;

import ar.com.burudos.sales.Summary;

import ar.com.burucps.sales.statement.StatementLineGroup;
import ar.com.burucps.sales.statement.StatementLineType;

global ar.com.burudos.sales.statement.EmployeeStatement statement
global java.util.Map additionalValues

dialect "mvel"

/* ********************** PUNTOS *********************** */
rule "Puntos - Altas IEM"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "IEM_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_IEM_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 10);
end

rule "Puntos - Bajas IEM"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "IEM_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_IEM_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 11);
end

rule "Puntos - Altas Cambios de Plan"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CPLAN_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_CPLAN_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 20);
end

rule "Puntos - Bajas Cambios de Plan"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CPLAN_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_CPLAN_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 21);
end

rule "Puntos - Altas Paquetes de Servicio"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "SVC_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_SVC_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 30);
end

rule "Puntos - Bajas Paquetes de Servicio"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "SVC_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_SVC_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 31);
end

rule "Puntos - Altas Garantías"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "GTIA_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_GTIA_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 40);
end

rule "Puntos - Bajas Garantías"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "GTIA_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_GTIA_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 41);
end

rule "Puntos - Altas Migraciones Positivas"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "MIG_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_MIGPOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 50);
end

rule "Puntos - Bajas Migraciones Positivas"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "MIG_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_MIGPOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 51);
end

rule "Puntos - Altas CATER Pospago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CATER_POS_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_CATERPOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 60);
end

rule "Puntos - Bajas CATER Pospago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CATER_POS_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_CATERPOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 61);
end

rule "Puntos - Altas CATER Prepago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CATER_PRE_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_CATERPRE_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 70);
end

rule "Puntos - Bajas CATER Prepago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CATER_PRE_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_CATERPRE_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 71);
end

rule "Puntos - Altas CASIM Pospago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CASIM_POS_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_CASIMPOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 80);
end

rule "Puntos - Bajas CASIM Pospago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CASIM_POS_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_CASIMPOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 81);
end

rule "Puntos - Altas CASIM Prepago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CASIM_PRE_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_CASIMPRE_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 90);
end

rule "Puntos - Bajas CASIM Prepago"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "CASIM_PRE_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_CASIMPRE_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 91);
end

rule "Puntos - Altas Bonos"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "BONOS_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_BONOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 100);
end

rule "Puntos - Bajas Bonos"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "BONOS_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_BONOS_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 101);
end

rule "Puntos - Altas Movitalk"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "MTALK_ALTAS")
	$p : Parameter(paramCode == "PUNTOS_ALTAS_MT_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 110);
end

rule "Puntos - Bajas Movitalk"
salience 99
when
	$empleado : Employee()
	$total : Summary(bu == $empleado.bu && summaryCode == "MTALK_BAJAS")
	$p : Parameter(paramCode == "PUNTOS_BAJAS_MT_PU_PTS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 111);
end

/* ****************** TOTAL PUNTOS ********************* */
rule "Totalización de puntos"
	salience 95
	when
		$empleado: Employee()
		$pPuntajeObjetivo : Parameter(paramCode == "PTOVTA_OBJ_PTS")
		$pPorcentajePuntajeObjetivoMinimo : Parameter(paramCode == "VTA_CTE_OBJ_PCT")
	then
		Double total = 0.0D;
		/*Iterator iterador = (Iterator) statement.getPointsLines().iterator();
		while (iterador.hasNext()) {
			StatementLine item = (StatementLine) iterador.next();
			total += item.amount; 
		}
		statement.setPointsSubtotal(total);
		Double porcentajeAlcanzado = (total / $pPuntajeObjetivo.getValue()) * 100.0;
		Integer factor = 1;
		if (porcentajeAlcanzado < $pPorcentajePuntajeObjetivoMinimo.getValue()) {
			factor = 0;
		}
		additionalValues.put("puntaje",total);
		additionalValues.put("porcentajeAlcanzado",porcentajeAlcanzado);
		additionalValues.put("factorAltas",factor);*/
end
/* ******************** FIN PUNTOS ********************* */
/* ********************** ALTAS ************************ */

rule "Altas - IM Ahorro/Contrato"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "IM")
		$p : Parameter(paramCode == "VTA_IM_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 10);
end

rule "Altas - MEC (Local)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "MECL")
		$p : Parameter(paramCode == "VTA_MEC_LOC_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 20);
end

rule "Altas - MEC (Externo)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "MECE")
		$p : Parameter(paramCode == "VTA_MEC_EXT_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 21);
end

rule "Altas - Planes Externo/Interno Rango 1 (..49)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PLAN1")
		$p : Parameter(paramCode == "VTA_PLA_RG1_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		System.out.println("PLAN1 - factor = " + factor);
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 30);
end

rule "Altas - Planes Externo/Interno Rango 2 (49-99)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PLAN2")
		$p : Parameter(paramCode == "VTA_PLA_RG2_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		System.out.println("PLAN2 - factor = " + factor);
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 31);
end

rule "Altas - Planes Externo/Interno Rango 3 (99-159)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PLAN3")
		$p : Parameter(paramCode == "VTA_PLA_RG3_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		System.out.println("PLAN3 - factor = " + factor);
			
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 32);
end

rule "Altas - Planes Externo/Interno Rango 4 (159-229)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PLAN4")
		$p : Parameter(paramCode == "VTA_PLA_RG4_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		System.out.println("PLAN4 - factor = " + factor);
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 33);
end

rule "Altas - Planes Externo/Interno Rango 5 (229..)"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PLAN5")
		$p : Parameter(paramCode == "VTA_PLA_RG5_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		System.out.println("PLAN5 - factor = " + factor);
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 34);
end

rule "Altas - Planes Corporativos"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "CORP")
		$p : Parameter(paramCode == "VTA_PLA_CORP_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 40);
end

rule "Altas - Accesorios"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "ACC")
		$p : Parameter(paramCode == "VTA_ACC_BON_PCT")
	then
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() / 100.0, 50);
end

rule "Altas - Prepago Interno"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PREP")
		$p : Parameter(paramCode == "VTA_PREP_INT_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 60);
end

rule "Altas - Operaciones Call Center"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "CALL")
		$p : Parameter(paramCode == "VTA_CALL_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 70);
end

rule "Altas - Operaciones Terreno"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "TERR")
		$p : Parameter(paramCode == "VTA_TERR_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 75);
end

rule "Altas - Tarjeta Itaú Rango 1 (..10)"
	salience 90
	when
		$empleado : Employee()
		$p : Parameter(paramCode == "VTA_ITAU_RG1_PU_ARS")
		$total : Summary(employee == $empleado && summaryCode == "ITAU" && quantity <= $p.maxValue)
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 80);
end

rule "Altas - Tarjeta Itaú Rango 2 (10-20)"
	salience 90
	when
		$empleado : Employee()
		$p : Parameter(paramCode == "VTA_ITAU_RG2_PU_ARS")
		$total : Summary(employee == $empleado && summaryCode == "ITAU" && quantity >= $p.minValue && quantity <= $p.maxValue)
	then
		Integer factor = (Integer) additionalValues.get("factorAltas");Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 81);
end

rule "Altas - Tarjeta Itaú Rango 3 (20..)"
	salience 90
	when
		$empleado : Employee()
		$p : Parameter(paramCode == "VTA_ITAU_RG3_PU_ARS")
		$total : Summary(employee == $empleado && summaryCode == "ITAU" && quantity >= $p.minValue)
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 82);
end

rule "Altas - Portabilidades"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "PORT")
		$p : Parameter(paramCode == "VTA_PORT_PU_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 90);
end

rule "Altas - Incentivo Sony ZL"
	salience 90
	when
		$empleado : Employee()
		$total : Summary(employee == $empleado && summaryCode == "SONY")
		$p : Parameter(paramCode == "EXT_BON_SONYZL_ARS")
	then
		Integer factor = 1; 
		if (additionalValues.containsKey("factorAltas")) {
			factor = (Integer) additionalValues.get("factorAltas");
		}
		
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity() * factor, 99);
end
/* ******************* TOTAL ALTAS ********************* */
rule "Totalización por desempeño individual"
salience 85
when
	$empleado: Employee()
then
	Double total = 0.0D;
	/*Iterator iterador = (Iterator) statement.getSalesLines().iterator();
	while (iterador.hasNext()) {
		StatementLine item = (StatementLine) iterador.next();
		total += item.amount; 
	}
	statement.setStalesSubtotal(total);*/
end
/* ******************** FIN ALTAS ********************** */

/* ************** INCENTIVOS INDIVIDUALES ************** */
rule "Incentivos  Individuales - Altas 100% Q"
salience 80
when
	$empleado : Employee()
	$total : Summary(employee == $empleado && summaryCode == "ALTAS")
	$p : Parameter(paramCode == "QVTA_TOT_RG1_BON_ARS")
	$qAltas : Parameter(paramCode == "QVTA_ALTAS_OP")
	$qMec : Parameter(paramCode == "QVTA_MEC_OP")
	$qPrep : Parameter(paramCode == "QVTA_PREP_OP")
then
	Double qAltasTotal = $qAltas.getValue() + $qMec.getValue() + $qPrep.getValue();
	Double performance = $total.getQuantity() * 100.0 / (qAltasTotal / $empleado.getBu().getEmployeeCount());
	if ( (performance >= $p.getMinValue()) && (performance < $p.getMaxValue())) {
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
					null, null, $p.getValue(), 10);
	}
end

rule "Incentivos  Individuales - Altas 120% Q"
salience 80
when
	$empleado : Employee()
	$total : Summary(employee == $empleado && summaryCode == "ALTAS")
	$p : Parameter(paramCode == "QVTA_TOT_RG2_BON_ARS")
	$qAltas : Parameter(paramCode == "QVTA_ALTAS_OP")
	$qMec : Parameter(paramCode == "QVTA_MEC_OP")
	$qPrep : Parameter(paramCode == "QVTA_PREP_OP")
then
	Double qAltasTotal = $qAltas.getValue() + $qMec.getValue() + $qPrep.getValue();
	Double performance = $total.getQuantity() * 100.0 / (qAltasTotal / $empleado.getBu().getEmployeeCount());
	if (performance >= $p.getMinValue()) {
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				null, null, $p.getValue(), 11);
	}
end

rule "Incentivos  Individuales - MEC 100% Q"
salience 80
when
	$empleado : Employee()
	$total : Summary(employee == $empleado && summaryCode == "MEC")
	$p : Parameter(paramCode == "QVTA_MEC_PU_ARS")
	$q : Parameter(paramCode == "QVTA_MEC_OP")
then
	Double performance = $total.getQuantity() * 100.0 / ($q.getValue() / $empleado.getBu().getEmployeeCount());
	if (performance >= $p.getMinValue()) {
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 20);
	}
end

rule "Incentivos  Individuales - Altas de Voz 100% Q"
salience 80
when
	$empleado : Employee()
	// objetivo JAG
	$qJAG : Parameter(paramCode == "QJAG_ALTAS_OP")
	// objetivo bu
	$qBu : Parameter(paramCode == "QVTA_ALTAS_OP")
	// altas empleado
	$total : Summary(employee == $empleado && summaryCode == "ALTAS_VOZ")
	// altas jag TODO
	$totalBu : Summary(bu == $empleado.bu && summaryCode == "ALTAS_VOZ" && quantity < $qJAG.value)
	//$totalBu : Summary(bu == JAG && summaryCode == "ALTAS_VOZ" && quantity < $q.value)
	// parametro para la linea
	$p : Parameter(paramCode == "QVTA_ALTAS_PU_ARS")
then
	Double performance = $total.getQuantity() * 100.0 / ($qBu.getValue() / $empleado.getBu().getEmployeeCount());
	if (performance >= $p.getMinValue()) {
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 30);
	}
end

rule "Incentivos  Individuales - Altas de Voz 100% Q y Q Punto de Venta"
salience 80
when
	$empleado : Employee()
	// objetivo JAG
	$qJAG : Parameter(paramCode == "QJAG_ALTAS_OP")
	// objetivo bu
	$qBu : Parameter(paramCode == "QVTA_ALTAS_OP")
	// altas empleado
	$total : Summary(employee == $empleado && summaryCode == "ALTAS_VOZ")
	// altas jag TODO
	$totalBu : Summary(bu == $empleado.bu && summaryCode == "ALTAS_VOZ" && quantity >= $qJAG.value)
	//$totalBu : Summary(bu == JAG && summaryCode == "ALTAS_VOZ" && quantity < $q.value)
	// parametro para la linea
	$p : Parameter(paramCode == "QJAG_ALTAS_PU_ARS")
then
	Double performance = $total.getQuantity() * 100.0 / ($qBu.getValue() / $empleado.getBu().getEmployeeCount());
	if (performance >= $p.getMinValue()) {
		statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 31);
	}
end

rule "Incentivos  Individuales - CASIM Postpago"
salience 80
when
	$empleado : Employee()
	$total : Summary(employee == $empleado && summaryCode == "CASIM_REPRO")
	$p : Parameter(paramCode == "IIND_CASIM_PVTA_PU_ARS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
				$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 40);
end
/* ********** TOTAL INCENTIVOS INDIVIDUALES ************ */
rule "Totalización por incentivos individuales"
salience 75
when
	$empleado: Employee()
then
	Double total = 0.0D;
	/*Iterator iterador = (Iterator) statement.getIndIncentLines().iterator();
	while (iterador.hasNext()) {
		StatementLine item = (StatementLine) iterador.next();
		total += item.amount; 
	}
	statement.setIndIncentSubtotal(total);*/
end
/* ************ FIN INCENTIVOS INDIVIDUALES ************ */

/* ************ INCENTIVOS PUNTO DE VENTA ************** */
rule "Incentivos  Punto de Venta - 250 Altas Proporcional"
salience 70
when
	$empleado : Employee()
	$p : Parameter(paramCode == "IEMP_ALTAS_RG1_BON_ARS")
	$totalBu : Summary(bu == $empleado.bu && summaryCode == "ALTASYCATER" && quantity >= $p.minValue && quantity < $p.maxValue)
	$total : Summary(employee == $empleado && summaryCode == "ALTASYCATER")
then
	Double performance = $total.getQuantity() / $totalBu.getQuantity();
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), performance * 100.0, $p.getValue() * performance, 10);
end

rule "Incentivos  Punto de Venta - 300 Altas Proporcional"
salience 70
when
	$empleado : Employee()
	$p : Parameter(paramCode == "IEMP_ALTAS_RG2_BON_ARS")
	$totalBu : Summary(bu == $empleado.bu && summaryCode == "ALTASYCATER" && quantity >= $p.minValue)
	$total : Summary(employee == $empleado && summaryCode == "ALTASYCATER")
then
	Double performance = $total.getQuantity() / $totalBu.getQuantity();
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), performance, $p.getValue() * performance, 11);
end

rule "Incentivos  Punto de Venta - 1005 MEC ($ 5 adicionales por alta de MEC)* Sujeto al alcance de su Objetivo MEC EMPRESA"
salience 70
when
	$empleado : Employee()
	$p : Parameter(paramCode == "IEMP_MEC_PU_ARS")
	// TODO Esto es el MEC de la BU, no de JAG - CORREGIR
	$totalJAG : Summary(bu == $empleado.bu && summaryCode == "MEC" && quantity >= $p.minValue)
	$total : Summary(employee == $empleado && summaryCode == "MEC")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 20);
end

/* ********* TOTAL INCENTIVOS PUNTO DE VENTA *********** */
rule "Totalización por incentivos punto de venta"
salience 65
when
	$empleado: Employee()
then
	Double total = 0.0D;
	/*Iterator iterador = (Iterator) statement.getPosIncentLines().iterator();
	while (iterador.hasNext()) {
		StatementLine item = (StatementLine) iterador.next();
		total += item.amount; 
	}
	statement.setPosIncentSubtotal(total);*/
end
/* ********** FIN INCENTIVOS PUNTO DE VENTA  *********** */

/* ******************** DEDUCCIONES ******************** */
rule "Bajas - IM"
salience 60
when
	$empleado : Employee()
	$p : Parameter(paramCode == "BAJAS_IM_PU_ARS")
	$total : Summary(employee == $empleado && summaryCode == "IM_BAJAS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 10);
end

rule "Bajas - MEC"
salience 60
when
	$empleado : Employee()
	$p : Parameter(paramCode == "BAJAS_MEC_PU_ARS")
	$total : Summary(employee == $empleado && summaryCode == "MEC_BAJAS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 20);
end

rule "Bajas - Planes Interno/Externo"
salience 60
when
	$empleado : Employee()
	$p : Parameter(paramCode == "BAJA_PLAN_PU_ARS")
	$total : Summary(employee == $empleado && summaryCode == "PLAN_BAJAS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 30);
end

rule "Bajas - CDP a planes Full"
salience 60
when
	$empleado : Employee()
	$p : Parameter(paramCode == "BAJA_CPLANFULL_PU_ARS")
	$total : Summary(employee == $empleado && summaryCode == "FULL_BAJAS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 40);
end

rule "Bajas - Observaciones (Reclamos)"
salience 60
when
	$empleado : Employee()
	$p : Parameter(paramCode == "BAJA_RECLAMOS_PU_ARS")
	$total : Summary(employee == $empleado && summaryCode == "RECLAMOS")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
			$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 50);
end

rule "Bajas - Débitos por fraudes"
salience 60
when
	$empleado : Employee()
	$p : Parameter(paramCode == "BAJA_FRAUDES")
	$total : Summary(employee == $empleado && summaryCode == "FRAUDES")
then
	statement.addLine(StatementLineType.RULE, $p.getParamCategory(), $p.getCurrentDescription(), 
		$p.getValue(), $total.getQuantity(), $p.getValue() * $total.getQuantity(), 60);
end

rule "Bajas - Diferencias de precio"
salience 60
when
	$empleado : Employee()
	$total : Summary(employee == $empleado && summaryCode == "DIF_PRECIOS")
then
	statement.addLine(StatementLineType.RULE, StatementLineGroup.DEDUCTIONS, "Diferencias de precio", 
			null, null, $total.getQuantity(), 70);
end

/* **************** TOTAL DEDUCCIONES ****************** */
rule "Totalización por deducciones"
salience 55
when
	$empleado: Employee()
then
	Double total = 0.0D;
	/*Iterator iterador = (Iterator) statement.getDeductionsLines().iterator();
	while (iterador.hasNext()) {
		StatementLine item = (StatementLine) iterador.next();
		total += item.amount; 
	}
	statement.setDeductionsSubtotal(total);*/
end
/* ****************** FIN DEDUCCIONES ****************** */

/* ******************** REDONDEO *********************** */
/*rule "Redondeo"
salience 50
when
	$empleado: Employee()
then
	Double posSubtotal = statement.getStalesSubtotal() + statement.getIndIncentSubtotal() 
							+ statement.getPosIncentSubtotal();
	statement.setPositiveSubtotal(posSubtotal);
	Double balance = posSubtotal - statement.getDeductionsSubtotal();
	if (balance > 0.0D) {
		// TODO REDONDEO
		Double redondeo = 0.0D;
		statement.setTotal(balance + redondeo);
	} else if (balance < 0.0D) {
		statement.setDueBalance(balance);
		statement.setTotal(0.0D);
	}
end*/
/* ****************** FIN REDONDEO ********************* */
