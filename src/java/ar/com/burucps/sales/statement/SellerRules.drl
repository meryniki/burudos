package ar.com.burucps.sales.statement

import ar.com.burucps.business.BusinessUnitTree
import ar.com.burudos.party.Employee
import ar.com.burucps.sales.statement.ParameterResolver
import ar.com.burudos.sales.statement.Statement
import ar.com.burudos.sales.statement.StatementLineType

global ar.com.burucps.sales.statement.ParameterResolver parameterResolver 
global ar.com.burucps.business.BusinessUnitTree businessUnitsTree
global ar.com.burudos.sales.statement.Statement statement
global java.util.Map additionalValues

dialect "mvel"

/* ********************** PUNTOS *********************** */
rule "Puntos - Altas IEM"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "IEM_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_IEM_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 10);
end

rule "Puntos - Bajas IEM"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "IEM_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_IEM_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 11);
end

rule "Puntos - Altas Cambios de Plan"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CPLAN_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_CPLAN_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 20);
end

rule "Puntos - Bajas Cambios de Plan"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CPLAN_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_CPLAN_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 21);
end

rule "Puntos - Altas Paquetes de Servicio"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "SVC_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_SVC_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 30);
end

rule "Puntos - Bajas Paquetes de Servicio"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "SVC_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_SVC_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 31);
end

rule "Puntos - Altas Garantías"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "GTIA_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_GTIA_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 40);
end

rule "Puntos - Bajas Garantías"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "GTIA_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_GTIA_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 41);
end

rule "Puntos - Altas Migraciones Positivas"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "MIG_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_MIGPOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 50);
end

rule "Puntos - Bajas Migraciones Positivas"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "MIG_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_MIGPOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 51);
end

rule "Puntos - Altas CATER Pospago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CATER_POS_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_CATERPOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 60);
end

rule "Puntos - Bajas CATER Pospago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CATER_POS_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_CATERPOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 61);
end

rule "Puntos - Altas CATER Prepago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CATER_PRE_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_CATERPRE_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 70);
end

rule "Puntos - Bajas CATER Prepago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CATER_PRE_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_CATERPRE_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 71);
end

rule "Puntos - Altas CASIM Pospago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CASIM_POS_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_CASIMPOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 80);
end

rule "Puntos - Bajas CASIM Pospago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CASIM_POS_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_CASIMPOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 81);
end

rule "Puntos - Altas CASIM Prepago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CASIM_PRE_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_CASIMPRE_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 90);
end

rule "Puntos - Bajas CASIM Prepago"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "CASIM_PRE_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_CASIMPRE_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 91);
end

rule "Puntos - Altas Bonos"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "BONOS_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_BONOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 100);
end

rule "Puntos - Bajas Bonos"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "BONOS_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_BONOS_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 101);
end

rule "Puntos - Altas Movitalk"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "MTALK_ALTAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_ALTAS_MT_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 110);
end

rule "Puntos - Bajas Movitalk"
salience 99
when
	$empleado : Employee
	$total : Summary(employee == $empleado && summaryCode == "MTALK_BAJAS")
then
	Parameter p = parameterResolver.resolve("PUNTOS_BAJAS_MT_PU_PTS",$empleado.bu);
	
	statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
				p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 111);
end

/* ****************** TOTAL PUNTOS ********************* */
rule "Totalización de puntos"
	salience 95
	when
		$empleado: Employee
	then
		Parameter pPuntajeObjetivo = parameterResolver.resolve("VTA_CTE_OBJ_PCT",$empleado.bu);
		Parameter pPorcentajePuntajeObjetivoMinimo = parameterResolver.resolve("VTA_CTE_OBJ_PCT",$empleado.bu);
		Integer total = 0;
		for (StatementLine item : statement.getPointsLines() ) {
			total += item.amount; 
		}
		statement.setPointsSubtotal(total);
		Double porcentajeAlcanzado = (total / pPuntajeObjetivo.value) * 100.0;
		
end
/* ******************** FIN PUNTOS ********************* */
/* ********************** ALTAS ************************ */

rule "Altas - IM Ahorro/Contrato"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "IM")
	then
		Parameter p = parameterResolver.resolve("VTA_IM_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 10);
end

rule "Altas - MEC (Local)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "MECL")
	then
		Parameter p = parameterResolver.resolve("VTA_MEC_LOC_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 20);
end

rule "Altas - MEC (Externo)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "MECE")
	then
		Parameter p = parameterResolver.resolve("VTA_MEC_EXT_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 21);
end

rule "Altas - Planes Externo/Interno Rango 1 (..49)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PLAN1")
	then
		Parameter p = parameterResolver.resolve("VTA_PLA_RG1_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 30);
end

rule "Altas - Planes Externo/Interno Rango 2 (49-99)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PLAN2")
	then
		Parameter p = parameterResolver.resolve("VTA_PLA_RG2_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 31);
end

rule "Altas - Planes Externo/Interno Rango 3 (99-159)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PLAN3")
	then
		Parameter p = parameterResolver.resolve("VTA_PLA_RG3_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 32);
end

rule "Altas - Planes Externo/Interno Rango 4 (159-229)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PLAN4")
	then
		Parameter p = parameterResolver.resolve("VTA_PLA_RG4_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 33);
end

rule "Altas - Planes Externo/Interno Rango 5 (229..)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PLAN5")
	then
		Parameter p = parameterResolver.resolve("VTA_PLA_RG5_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 34);
end

rule "Altas - Planes Corporativos"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "CORP")
	then
		Parameter p = parameterResolver.resolve("VTA_PLA_CORP_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 40);
end

rule "Altas - Accesorios"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "ACC")
	then
		Parameter p = parameterResolver.resolve("VTA_ACC_BON_PCT",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 50);
end

rule "Altas - Prepago Interno"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PREP")
	then
		Parameter p = parameterResolver.resolve("VTA_PREP_INT_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 60);
end

rule "Altas - Operaciones Call Center"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "CALL")
	then
		Parameter p = parameterResolver.resolve("VTA_CALL_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 70);
end

rule "Altas - Operaciones Terreno"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "TERR")
	then
		Parameter p = parameterResolver.resolve("VTA_TERR_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 75);
end

rule "Altas - Tarjeta Itaú Rango 1 (..10)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "ITAU1")
	then
		Parameter p = parameterResolver.resolve("VTA_ITAU_RG1_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 80);
end

rule "Altas - Tarjeta Itaú Rango 2 (10-20)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "ITAU2")
	then
		Parameter p = parameterResolver.resolve("VTA_ITAU_RG2_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 81);
end

rule "Altas - Tarjeta Itaú Rango 3 (20..)"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "ITAU3")
	then
		Parameter p = parameterResolver.resolve("VTA_ITAU_RG3_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 82);
end

rule "Altas - Portabilidades"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "PORT")
	then
		Parameter p = parameterResolver.resolve("VTA_PORT_PU_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 90);
end

rule "Altas - Incentivo Sony ZL"
	salience 50
	when
		$empleado : Employee
		$total : Summary(employee == $empleado && summaryCode == "SONY")
	then
		Parameter p = parameterResolver.resolve("EXT_BON_SONYZL_ARS",$empleado.bu);
		
		statement.addLine(StatementLineType.RULE, p.getParamCategory(), p.getCurrentDescription(), 
					p.getValue(), $total.getQuantity(), p.getValue() * $total.getQuantity(), 99);
end

/* ******************** FIN ALTAS ********************** */